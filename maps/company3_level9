В глубинах астрала
# F - Forest
# L - Land
# M - Mountain
# R - Ruines
# H - Home
# T - Tower

MAP
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZXZZZZ
ZZZZZZZZZZZXXXZZZ
ZZZZZZZZZZZZYXZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZXXXXZZZZZZZZZZ
ZZZXYZZZZZZZZZZZZ
ZZZZXZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZYXZZZZ
ZZZZZZZZZZXXXXZZ
ZZZZZZZZZZZZXZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZXXZZZZZZZ
ZZZZZZXXXZZZZZZZZ
ZZZZZZZXXZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZ
#===MAPEND===

# Раздел константы должен идти в самом начале
CONSTANTS
LowLevel:41

OBJECTS
Pony:i=8,j=1,"name=Каденс",code=cadence,disableflying=true

#Monster:Code=ameba,"Name=Амеба",i=26,j=20
#Monster:Code=bat,"Name=Нетопырь",i=27,j=21
#Monster:Code=bat,"Name=Нетопырь",i=28,j=20
#Monster:Code=bat,"Name=Нетопырь",i=29,j=21
#Monster:Code=ameba,"Name=Амеба",i=30,j=20

INITIAL
Stone:0
Food:500
Task:Добраться до нижнего слоя астрала (последний островок материи)
Permits:action=deny,code=all
Permits:action=allow,code=BuildFarmFood
Permits:action=allow,code=Harvest
Permits:action=allow,code=AttackNear
Permits:action=allow,code=AttackLong
Permits:action=allow,code=FreezeEnemy
Permits:action=allow,code=Teleport
Permits:action=allow,code=SonicRainbow
Permits:action=allow,code=Heal
Permits:action=allow,code=Restore
Permits:action=allow,code=CutEmptySector
Permits:action=allow,code=BuildTreeShield
Permits:action=allow,code=BuildCrystalTowerBig
Permits:action=allow,code=BuildCrystalTowerSmall
Permits:action=allow,code=FlatterView
Permits:action=allow,code=ForceShieldCadence
Permits:action=allow,code=PrincessKiss
Permits:action=allow,code=CadenceExtraAttack

SCRIPT      
Event:Step=0
Action:Type=SetFocus,i=8,j=2
Action:Type=Message,icon=cadence_ico,"text=Хорошо было распускать перья перед Селестией. А здесь - не очень хорошо. Мои силы... убывают с каждой минутой. И перемещаться здесь очень сложно. Но я должна попытаться."
Action:Type=Message,icon=ok_ico,"text=Показатель максимальной силы Каденс убывает каждый ход, если она не стоит на островке материи. Перемещение вне островков материи возможно только на одну клетку. Телепортации это не касается."
Action:Type=ShowBattleTask

SCRIPT
Event:Step=1
Action:Type=NewObjectGroup,Object=Monster,Code=shadow,"Name=Тень",i=1,j=2,count=1,radius=2

SCRIPT
Event:Step=2
Action:Type=NewObjectGroup,Object=Monster,Code=shadow,"Name=Тень",i=15,j=4,count=1,radius=2

SCRIPT
Event:Step=5
Action:Type=NewObjectGroup,Object=Monster,Code=shadow,"Name=Тень",i=2,j=7,count=1,radius=2

SCRIPT
Event:Step=6
Action:Type=NewObjectGroup,Object=Monster,Code=shadow,"Name=Тень",i=14,j=10,count=1,radius=2

SCRIPT
Event:Step=9
Action:Type=NewObjectGroup,Object=Monster,Code=shadow,"Name=Тень",i=3,j=14,count=2,radius=2

SCRIPT
Event:Step=11
Action:Type=NewObjectGroup,Object=Monster,Code=shadow,"Name=Тень",i=13,j=18,count=2,radius=2

SCRIPT
Event:Step=14
Action:Type=NewObjectGroup,Object=Monster,Code=shadow,"Name=Тень",i=3,j=27,count=2,radius=2

SCRIPT
Event:Step=17
Action:Type=NewObjectGroup,Object=Monster,Code=shadow,"Name=Тень",i=13,j=31,count=2,radius=2

SCRIPT
Event:Step=21
Action:Type=NewObjectGroup,Object=Monster,Code=shadow,"Name=Тень",i=3,j=34,count=3,radius=2

SCRIPT
Event:Step=25
Action:Type=NewObjectGroup,Object=Monster,Code=shadow,"Name=Тень",i=13,j=38,count=3,radius=2

SCRIPT
Event:Step=30
Action:Type=NewObjectGroup,Object=Monster,Code=shadow,"Name=Тень",i=4,j=43,count=3,radius=2

SCRIPT
Event:Step=35
Action:Type=NewObjectGroup,Object=Monster,Code=shadow,"Name=Тень",i=12,j=47,count=4,radius=2

SCRIPT
Event:Step=39
Action:Type=NewObjectGroup,Object=Monster,Code=shadow,"Name=Тень",i=5,j=50,count=4,radius=2

SCRIPT
Event:Step=44
Action:Type=NewObjectGroup,Object=Monster,Code=shadow,"Name=Тень",i=12,j=52,count=4,radius=2

SCRIPT
Event:Step=51
Action:Type=NewObjectGroup,Object=Monster,Code=shadow,"Name=Тень",i=5,j=57,count=4,radius=2

SCRIPT
Event:Step=57
Action:Type=NewObjectGroup,Object=Monster,Code=shadow,"Name=Тень",i=11,j=58,count=5,radius=2

SCRIPT
Event:Step=67
Action:Type=NewObjectGroup,Object=Monster,Code=shadow,"Name=Тень",i=5,j=59,count=5,radius=2

SCRIPT
Event:Step=70
Action:Type=NewObjectGroup,Object=Monster,Code=shadow,"Name=Тень",i=11,j=60,count=7,radius=2

SCRIPT
Event:ObjectPos=True,Direction=GreatY,i=5,j=@LowLevel@,"Object=cadence"
Action:Type=Message,icon=darkness_ico,"text=Для такой слабой пони, ты зашла удивительно далеко."
Action:Type=Message,icon=cadence_ico,"text=Полагаю, Мрак, один из изначальных духов нашего мира?"
Action:Type=Message,icon=darkness_ico,"text=Возможно. Но здесь не место ни тебе, ни любой другой пони. Уходи, я задержу теней."
Action:Type=Message,icon=cadence_ico,"text=Я пришла не бежать, а просить помощи! Эквестрия распадается на части, мои друзья пытаются это остановить, но им очень тяжко. Ради мира, частью которого ты являешься..."
Action:Type=Message,icon=darkness_ico,"text=Как уже было сказано вашей главной принцессе - я не могу создавать. И мне нет дела до мира - я прекрасно себя чувствую в астральном измерении."
Action:Type=Message,icon=cadence_ico,"text=Хорошо, мелкий злобный дух. Я предвидела такой поворот и подготовилась. Король Сомбра планировал захватить не только Эквестрию, но и астрал. Он создал несколько... устройств, которые после установки в узлах астрала - свернут его так, что в орехе будет просторней. Или ты помогаешь - или остаёшься без дома!"
Action:Type=Message,icon=darkness_ico,"text=Ты не посмеешь. Даже если сможешь установить подобное, при сворачивании астрала тебе не будет обратной дороги."
Action:Type=Message,icon=cadence_ico,"text=Готов рискнуть? Ми Аморе Каденс против Мрака, такого ещё никто не видел."
Action:Type=SetPermits,action=allow,code=SetupAstralBomb
Action:Type=CompBattleTask,code=initial
Action:Type=SetBattleTask,code=bomb,"Task=Установить три астральные мины в узловые точки (звездные дыры в астрале). Бомбы могут быть разрушены противниками."
Action:Type=ShowBattleTask
Action:Type=SetExtInfoModel,"ModelMicroCode=mapastral;Осталось установить мин: %d;3;Мины установлены!"

SCRIPT
Event:BuildingCount=3,BuildingCode=AstralBomb
Action:Type=Message,icon=cadence_ico,"text=Я сделала это! Стоит мне активировать мины - и здесь не останется ничего!"
Action:Type=Message,icon=darkness_ico,"text=Должен признать, твоя решимость меня удивляет. Ми Аморе Каденс, рожденная пегасом - я даю обещание выйти в Эквестрию и предложить помощь... так, как я её вижу."
Action:Type=Message,icon=cadence_ico,"text=Приятно иметь дело с разумным духом. А теперь, мне пора убираться отсюда."
Action:Type=SetExtInfoModel
Action:Type=SetPermits,action=deny,code=SetupAstralBomb
Action:Type=CompBattleTask,code=bomb
Action:Type=SetBattleTask,code=escape,"Task=Добраться до самого верхнего слоя астрала"
Action:Type=ShowBattleTask
Action:Type=SetFlag,FlagName=escape

SCRIPT
Event:ObjectPos=True,Direction=LessY,i=5,j=1,"Object=cadence"
Event1:Flag=escape
Action:Type=Message,icon=cadence_ico,"text=Ужасное место. Надеюсь, мне больше не придется повторять такие подвиги."
Action:Type=SetFlag,FlagName=victory

VICTORY
ByFlag:FlagName=victory
